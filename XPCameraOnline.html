<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Filmer en 1080p</title>
</head>
<body>
<h1>ğŸ¥ Filmer en 1080p</h1>
<video id="preview" autoplay muted></video><br>
<button id="startBtn">DÃ©marrer</button>
<button id="stopBtn" disabled>ArrÃªter</button>
<a id="downloadLink" style="display:none">TÃ©lÃ©charger</a>

<script>
const video = document.getElementById("preview");
const startBtn = document.getElementById("startBtn");
const stopBtn = document.getElementById("stopBtn");
const downloadLink = document.getElementById("downloadLink");

let mediaRecorder;
let recordedChunks = [];
let stream;

async function startRecording() {
    try {
        // 1920x1080
        stream = await navigator.mediaDevices.getUserMedia({
            video: { width: 1920, height: 1080 },
            audio: true
        });
        video.srcObject = stream;

        let options = { mimeType: 'video/mp4; codecs="avc1.42E01E, mp4a.40.2"' };
        if (!MediaRecorder.isTypeSupported(options.mimeType)) {
            alert("MP4 direct non supportÃ©, WebM sera utilisÃ©.");
            options = { mimeType: 'video/webm; codecs="vp8, opus"' };
        }

        recordedChunks = [];
        mediaRecorder = new MediaRecorder(stream, options);

        mediaRecorder.ondataavailable = e => {
            if (e.data.size > 0) recordedChunks.push(e.data);
        };

        mediaRecorder.onstop = e => {
            const blob = new Blob(recordedChunks, { type: options.mimeType });
            const url = URL.createObjectURL(blob);
            downloadLink.href = url;
            downloadLink.download = options.mimeType.startsWith("video/mp4") ? "video_1080p.mp4" : "video_1080p.webm";
            downloadLink.style.display = "inline";
        };

        mediaRecorder.start();
        startBtn.disabled = true;
        stopBtn.disabled = false;
    } catch(err) {
        alert("Erreur d'accÃ¨s Ã  la camÃ©ra ou au micro : " + err.message);
    }
}

function stopRecording() {
    mediaRecorder.stop();
    stream.getTracks().forEach(track => track.stop());
    startBtn.disabled = false;
    stopBtn.disabled = true;
}

startBtn.addEventListener("click", startRecording);
stopBtn.addEventListener("click", stopRecording);
</script>
</body>
</html>
